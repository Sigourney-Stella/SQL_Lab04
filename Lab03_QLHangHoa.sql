----------------TẠO CSDL--------------------------
 
 CREATE DATABASE QLHH
 GO 
 USE [QLHH]
 GO

CREATE TABLE VATTU
(
	MAVTU CHAR(4) NOT NULL,
	TENVTU NVARCHAR(100) CONSTRAINT UQ_VATTU_TENVTU UNIQUE(TENVTU),
	DVTINH NVARCHAR(10) CONSTRAINT DF_VATTU_DVTINH DEFAULT '',
	PHANTRAM REAL CONSTRAINT CK_VATTU_PHANTRAM CHECK (PHANTRAM BETWEEN 0 AND 100),
	PRIMARY KEY (MAVTU),
)
GO
---------------------------
 drop table NHACC
CREATE TABLE NHACC
(
	MANCC char(3) not null,
	TENNCC nvarchar(100) not null,
	DIACHI nvarchar(200) not null,
	DIENTHOAI nvarchar(20) CONSTRAINT DF_NHACC_Dienthoai DEFAULT 'chua co',
	Primary Key (MANCC),
)
GO
----------------------------
DROP TABLE DONDH
CREATE TABLE DONDH
(
	SODH char(4) not null,
	NGAYDH datetime CONSTRAINT DF_DONDH_NGAYDH DEFAULT GETDATE(),
	MANCC char(3) not null,
	Primary Key (SODH),
)
GO
------------------------------
DROP TABLE CTDONDH

CREATE TABLE CTDONDH
(
	SODH char(4) not null CONSTRAINT FK_CTDONDH_SODH FOREIGN KEY REFERENCES DONDH,
	MAVTu char(4) not null CONSTRAINT FK_CTDONDH_MAVTU FOREIGN KEY REFERENCES VATTU,
	SLDAT int CONSTRAINT CK_CTDONDH_SLDATE CHECK(SLDAT>0)
)
GO
-------------------------
CREATE TABLE PNHAP
(
	SOPN CHAR(4) PRIMARY KEY,
	NGAYNHAP DATETIME CONSTRAINT DF_PNHAP_NGAYNHAP DEFAULT GETDATE(),
	SODH CHAR(4) NOT NULL CONSTRAINT FK_PNHAP_SODH FOREIGN KEY REFERENCES DONDH
)
GO
------------------------------
DROP TABLE CTPNHAP
CREATE TABLE CTPNHAP
(
	SOPN CHAR(4) NOT NULL CONSTRAINT FK_CTNHAP_SOPN FOREIGN KEY REFERENCES PNHAP,
	MAVTU CHAR(4) NOT NULL CONSTRAINT FK_PNHAP_MAVTU FOREIGN KEY REFERENCES VATTU,
	SLNHAP INT NOT NULL CONSTRAINT CK_CTPNHAP_SLNHAP CHECK(SLNHAP > 0),
	DGNHAP MONEY NOT NULL CONSTRAINT CK_CTPNHAP_DGNHAP CHECK(DGNHAP>0),
	CONSTRAINT PK_CTPNHAP PRIMARY KEY(SOPN,MAVTU)
)
GO
------------------------------
CREATE TABLE PXUAT
(
	SOPX CHAR(4) NOT NULL PRIMARY KEY,
	NGAYXUAT DATETIME CONSTRAINT DF_PXUAT_NGAYXUAT DEFAULT GETDATE(),
	TENKH NVARCHAR(100) NOT NULL
)
GO
---------------
DROP TABLE CTPXUAT
CREATE TABLE CTPXUAT
(
	SOPX CHAR(4) NOT NULL CONSTRAINT FK_CTXUAT_SOPX FOREIGN KEY REFERENCES PXUAT,
	MAVTU CHAR(4) NOT NULL CONSTRAINT FK_CTPXUAT_MAVTU FOREIGN KEY REFERENCES VATTU,
	SLXUAT INT NOT NULL CONSTRAINT CK_CTPXUAT_SLXUAT CHECK(SLXUAT>0),
	DGXUAT MONEY NOT NULL CONSTRAINT CK_CTPXUAT_DGXUAT CHECK(DGXUAT>0),
	CONSTRAINT PK_CTPXUAT PRIMARY KEY(SOPX,MAVTU)
)
GO
--------------------------------
DROP TABLE TONKHO
CREATE TABLE TONKHO
(
	NAMTHANG CHAR(6) NOT NULL,
	MAVTU CHAR(4) NOT NULL CONSTRAINT FK_TONKHO_MAVTU FOREIGN KEY REFERENCES VATTU,
	SLDAU INT NOT NULL CONSTRAINT CK_TONKHO_SLDAU CHECK(SLDAU>0),
	TONGSLN INT NOT NULL CONSTRAINT CK_TONKHO_TONGSLN CHECK(TONGSLN>0),
	TONGSLX INT NOT NULL CONSTRAINT CK_TONKHO_TONGSLX CHECK(TONGSLX>0),
	SLCUOI AS (SLDAU + TONGSLN - TONGSLX),
	CONSTRAINT PK_TONKHO Primary key (NAMTHANG,MAVTU)
)
GO
---------------------------------------
/*Du Lieu Bang Nha Cung Cap*/
INSERT INTO NHACC VALUES ('C01',N'Lê Minh Trí',N'54 Hậu Giang Q6 HCM','8781024')
INSERT INTO NHACC VALUES ('C02',N'Trần Minh Thành',N'145 Hùng Vương, Ba Đình, Hà Nội','7698154')
INSERT INTO NHACC VALUES ('C03',N'Nguyễn Phương Anh',N'154/85 Lê Lợi, Hải Dương','8757757')
INSERT INTO NHACC VALUES ('C04',N'Lưu Vũ Quang',N'198/40 Kim Mã, Ba Đình, Hà Nội','9600125')
INSERT INTO NHACC VALUES ('C05',N'Vũ Anh Tú',N'178 Lê Văn Lương, Thanh Xuân, Hà Nội','7964251')
INSERT INTO NHACC VALUES ('C06',N'Cao Minh Trung',N'125 Lê Quang Sung, Nha Trang','')
Go
------------------------------------------------------------------------
/*Du Lieu Bang VATTU*/
INSERT INTO VATTU VALUES ('DD01',N'Đầu DVD Hitachi 1 cửa',N'Bộ',40)
INSERT INTO VATTU VALUES ('DD02',N'Đầu DVD Hitachi 3 cửa',N'Bộ',40)
INSERT INTO VATTU VALUES ('TL15',N'Tủ L¹nh Sanyo 150 lít',N'Chiếc',25)
INSERT INTO VATTU VALUES ('TL90',N'Tủ L¹nh Sanyo 90 lít',N'Chiếc',20)
INSERT INTO VATTU VALUES ('TV14',N'Tivi SONY 14 inches',N'Chiếc',15)
INSERT INTO VATTU VALUES ('TV21',N'Tivi SONY 21 inches',N'Chiếc',10)
INSERT INTO VATTU VALUES ('TV29',N'Tivi SONY 29 inches',N'Chiếc',10)
INSERT INTO VATTU VALUES ('VD01',N'Đầu VCD SONY 1 cửa',N'Bộ',30)
INSERT INTO VATTU VALUES ('VD02',N'Đầu VCD SONY 3 cửa',N'Bộ',30)
Go
------------------------------------------------------------------------
/*Du Lieu Bang DONDH*/
INSERT INTO DONDH VALUES('D001','01/15/2015','C03')
INSERT INTO DONDH VALUES('D002','01/30/2015','C01')
INSERT INTO DONDH VALUES('D003','02/10/2015','C02')
INSERT INTO DONDH VALUES('D004','02/17/2015','C05')
INSERT INTO DONDH VALUES('D005','03/01/2015','C02')
INSERT INTO DONDH VALUES('D006','03/12/2015','C05')
Go
------------------------------------------------------------------------
/*Du Lieu Bang PNHAP*/
INSERT INTO PNHAP VALUES('N001','01/17/2015','D001')
INSERT INTO PNHAP VALUES('N002','01/20/2015','D001')
INSERT INTO PNHAP VALUES('N003','01/31/2015','D002')
INSERT INTO PNHAP VALUES('N004','02/15/2015','D003')
Go
------------------------------------------------------------------------
/*Du Lieu Bang CTDONDH*/
INSERT INTO CTDONDH VALUES('D001','DD01',10)
INSERT INTO CTDONDH VALUES('D001','DD02',15)
INSERT INTO CTDONDH VALUES('D002','VD02',30)
INSERT INTO CTDONDH VALUES('D003','TV14',10)
INSERT INTO CTDONDH VALUES('D003','TV29',20)
INSERT INTO CTDONDH VALUES('D004','TL90',10)
INSERT INTO CTDONDH VALUES('D005','TV14',10)
INSERT INTO CTDONDH VALUES('D005','TV29',20)
INSERT INTO CTDONDH VALUES('D006','TV14',10)
INSERT INTO CTDONDH VALUES('D006','TV29',20)
INSERT INTO CTDONDH VALUES('D006','VD01',20)
Go
------------------------------------------------------------------------
/*Du Lieu Bang CTPNHAP*/
INSERT INTO CTPNHAP VALUES('N001','DD01',8 ,25)
INSERT INTO CTPNHAP VALUES('N001','DD02',10 ,35)
INSERT INTO CTPNHAP VALUES('N002','DD01', 2,25)
INSERT INTO CTPNHAP VALUES('N002','DD02', 5,35)
INSERT INTO CTPNHAP VALUES('N003','VD02', 30,25)
INSERT INTO CTPNHAP VALUES('N004','TV14', 5,25)
INSERT INTO CTPNHAP VALUES('N004','TV21', 12,35)


Go
------------------------------------------------------------------------
/*Du Lieu Bang PXUAT*/
INSERT INTO PXUAT VALUES('X001','01/17/2015',N'Nguyễn Ngọc Yến Nhi')
INSERT INTO PXUAT VALUES('X002','01/25/2015',N'Trịnh Anh Vũ')
INSERT INTO PXUAT VALUES('X003','01/31/2015',N'Đặng Hải Vân')
Go
------------------------------------------------------------------------
/*Du Lieu Bang CTPXUAT*/
INSERT INTO CTPXUAT VALUES('X001','DD01',2 ,35)
INSERT INTO CTPXUAT VALUES('X002','DD01',1 ,35)
INSERT INTO CTPXUAT VALUES('X002','DD02', 5,49)
INSERT INTO CTPXUAT VALUES('X003','DD01', 3,35)
INSERT INTO CTPXUAT VALUES('X003','DD02', 2,49)
INSERT INTO CTPXUAT VALUES('X003','VD02', 10,32.5)


Go
------------------------------------------------------------------------
/*Du Lieu Bang TONKHO*/

INSERT INTO TONKHO(Namthang,Mavtu,SLDau,TongSLN,TongSLX) VALUES('201501','DD01',0,10,6 )
INSERT INTO TONKHO(Namthang,Mavtu,SLDau,TongSLN,TongSLX) VALUES('201501','DD02',0,15,7 )
INSERT INTO TONKHO(Namthang,Mavtu,SLDau,TongSLN,TongSLX) VALUES('201501','VD02',0,30,10 )
INSERT INTO TONKHO(Namthang,Mavtu,SLDau,TongSLN,TongSLX) VALUES('201502','DD01',4,0,0 )
INSERT INTO TONKHO(Namthang,Mavtu,SLDau,TongSLN,TongSLX) VALUES('201502','DD02',8,0,0 )
INSERT INTO TONKHO(Namthang,Mavtu,SLDau,TongSLN,TongSLX) VALUES('201502','VD02',20,0,0 )
INSERT INTO TONKHO(Namthang,Mavtu,SLDau,TongSLN,TongSLX) VALUES('201502','TV14',5,0,0 )
INSERT INTO TONKHO(Namthang,Mavtu,SLDau,TongSLN,TongSLX) VALUES('201502','TV29',12,0,0 )
SELECT * FROM VATTU